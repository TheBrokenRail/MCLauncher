<div id="toolbar">
  <div class="button" id="newProfile">
    <span class="buttonText">New Profile</span>
  </div>
</div>
<div id="profiles"></div>
<div id="action">
  <div class="button disabled-button" id="play">
    <span class="buttonText">Play</span>
  </div>
</div>
<style>
#toolbar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 10%;
  background-color: grey;
}
.button {
  position: absolute;
  display: table;
  top: 25%;
  left: 25%;
  width: 50%;
  height: 50%;
  background-color: limegreen;
  font-family: sans-serif;
  text-align: center;
  color: white;
}
.button:hover {
  background-color: lime;
}
.buttonText {
  display: table-cell;
  vertical-align: middle;
  user-select: none;
}
#profiles {
  position: absolute;
  overflow: auto;
  top: 10%;
  left: 0;
  height: 80%;
  width: 100%;
  background-color: lightgrey;
}
#action {
  position: absolute;
  top: 90%;
  left: 0;
  width: 100%;
  height: 10%;
  background-color: grey;
}
.disabled-button {
  background-color: darkgrey !important;
}
.item {
  margin: 0;
  font-family: sans-serif;
  font-size: 150%;
  padding: 2%;
  background-color: silver;
  color: white;
}
.item:hover {
  background-color: darkgrey;
}
#selectedItem {
  background-color: limegreen;
}
</style>
<script>
const remote = require('electron').remote;
const path = require('path');
const url = require('url');
const request = require('request');
const fs = require('fs');
const launcher = require('./launcher');

function login() {
  let win = new remote.BrowserWindow({width: 400, height: 310, parent: remote.getCurrentWindow(), resizable: false});

  win.loadURL(url.format({
    pathname: path.join(__dirname, 'login.html'),
    protocol: 'file:',
    slashes: true
  }));
}
function getAuthData() {
  if (fs.existsSync('data/auth.json')) {
    let auth = JSON.parse(fs.readFileSync('./data/auth.json', 'utf8'));
    request.post('https://authserver.mojang.com/refresh', {
      json: {
        accessToken: auth.accessToken,
        clientToken: auth.clientToken
      }
    }, (error, response, body) => {
      if (response.statusCode === 200) {
        fs.writeFileSync('data/auth.json', JSON.stringify({accessToken: body.accessToken, clientToken: body.clientToken}));
        return body;
      } else {
        login();
      }
    });
  } else {
    login();
  }
}
getAuthData();
document.getElementById('newProfile').onclick = () => {
  let win = new remote.BrowserWindow({width: 400, height: 310, parent: remote.getCurrentWindow(), resizable: false});

  win.loadURL(url.format({
    pathname: path.join(__dirname, 'edit.html'),
    protocol: 'file:',
    slashes: true
  }));
  win.on('close', loadProfiles);
};
function loadProfiles() {
  let profiles = [];
  if (fs.existsSync('data/profiles.json')) {
    profiles = JSON.parse(fs.readFileSync('data/profiles.json', 'utf8'));
  }
  let profilesElement = document.getElementById('profiles');
  profilesElement.innerHTML = '';
  for (let i = 0; i < profiles.length; i++) {
    let item = document.createElement('P');
    item.classList.add('item');
    item.appendChild(document.createTextNode(profiles[i].name));
    item.onclick = () => {
      if (document.getElementById('selectedItem')) {
        document.getElementById('selectedItem').id = '';
      }
      item.id = 'selectedItem';
      document.getElementById('play').classList.remove('disabled-button');
    };
    item.setAttribute('data-id', i);
    profilesElement.appendChild(item);
  }
}
loadProfiles();
</script>